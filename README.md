Ссылка на репозиторий: https://github.com/Dmitry2040/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Код приложения WEB-ларёк разделен на:
- слой отображения (все что отвечает за вывод информации на экран пользователю);
- слой данных (вся логика приложения без интерфейса);
- presenter (связывает данные и отображение);

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

## Данные и типы данных используемые в приложении

Состояние приложения
```
interface IAppStateData {
  basket: IBasket[];
  cardsList: ICardItem[];
  preview: string | null;
  order: IOrder | null;
}
```

Типы событий
```
  ITEMS_CHANGED = 'items:changed',
  CARD_SELECT = 'card:select',
  PREVIEW_CHANGED = 'preview:changed',
  PRODUCT_DELETE = 'product:delete',
  BASKET_OPEN = 'basket:open',
  BASKET_ADD = 'basket:add',
  BASKET_CHANGED = 'basket:changed',
  FORM_ERRORS_CHANGE = 'formErrors:change',
  ORDER_OPEN = 'order:open',
  ORDER_READY = 'order:ready',
  ORDER_SUBMIT = 'order:submit',
  CONTACTS_READY = 'contacts:ready',
  CONTACTS_SUBMIT = 'contacts:submit',
  MODAL_OPEN = 'modal:open',
  MODAL_CLOSE = 'modal:close',
```

Данные главной страницы 
```
interface IPage {
  counter: number;
  catalog: HTMLElement[];
  locked: boolean;
}
```

Товар
```
interface ICardItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
  inBasket: boolean;
}
```

Данные заказа
```
interface IOrder {
  payment: string;
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Корзина товаров
```
interface IBasket {
  quantity: number;
  title: string;
  price: number;
  totalPrice: number;
}
```

Модальное окно
```
interface IModalData {
    content: HTMLElement;
}
```

Состояние формы
```
interface IFormState {
    valid: boolean;
    errors: string[];
}
```

Успешный заказ
```
interface ISuccess {
  total: number;
}
```


## Базовый код

### Класс `Api`

Базовый класс для отправки и получения запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

`constructor(baseUrl: string, options: RequestInit = {})` - принимает url сервера, по которому будут совершаться запросы и общие опции для этих запросов.

Поля:
- `baseUrl` - базовый адрес сервера;
- `options` - объект с заголовками запросов;

Методы:
- `handleResponse` - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате `json` или отклоненный промис с возникшей ошибкой;
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется 'POST' запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.;

### Класс `EventEmitter`

Классическая реализация брокера событий. Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

`constructor()` - инициализирует брокер событий;

Поля:
- `_events` - `Map`, состоящий из ивентов и подписчиков;

Методы:
- `on` - установка обработчика на событие;
- `off` - снятие обработчика с события;
- `emit` - инициализация события;
- `onAll` - подписка одновременно на все события;
- `offAll` - сброс всех обработчиков;
- `trigger` - возвращает функцию, генерирующую событие при вызове;

### Класс `Component<T>`

Абстрактный базовый класс, предназначенным для создания компонентов пользовательского интерфейса. Класс обеспечивает инструментарий для управления DOM элементами и поведением компонента. Наследуется всеми классами представления(View)

`constructor(container: HTMLElement)` - принимает элемент контейнера, в который будет помещен компонент;

Методы:
- `toggleClass` - переключается класс для переданного элемента;
- `setText` - устанавливает текстовое содержимое для переданного элемента;
- `setDisabled` - изменяет статус блокировки для переданного элемента;
- `setHidden`, `setVisible` - скрывает, отображает переданный элемент;
- `setImage` - устанавливает изображения и альтернативный текст для изоображения(опционально) для переданного элемента типа HTMLImageElement;
- `render` - рендерит компонент, используя переданные данные. Метод должен быть переназначен в дочерних классах;

### Класс `Model`

Абстрактный класс, представляет собой базовую модель данных.

- `constructor(data: Partial<T>, protected events: IEvents)` - конструктор принимает данные модели и объект событий, копирует данные в модель.

Методы: 
- `emitChanges(event: string, payload?: object)` - уведомляет о изменении модели;

### Слой данных

### Класс `AppData`
Расширяет класс Model. Отвечает за умправлением состояния приложения, храниение данных и выполнение операций.

Свойства:
- `basket: ICard[] = []` - данные о товаре в корзине;
- `catalog: ICard[]` - данные о товаре;
- `order: IOrder = {}` - данные о заказе;
- `preview: string | null` - идентификационный номер товара;
- `formErrors: FormErrors = {}` - ошибки полей формы;

Конструктор:
- `constructor()` - конструктор наследуется от класса Model

Методы:
- `addBasket(value: ICardItem)` - добавляет товар в корзину, если он еще не добавлен, и вызывает событие basket:changed;
- `removeBasket(value: ICardItem)` - удаляет товар из корзины и вызывает событие basket:changed;
- `clearBasket()` - очищает корзину товаров и вызывает событие basket:changed;
- `getTotalPrice()` - возвращает сумму всех товаров в корзине;
- `setCatalog(items: ICardItem[])` - устанавливает каталог товаров и вызывает событие items:changed;
- `setPreview(item: ICardItem)` - устанавливает товар для предварительного просмотра и вызывает событие preview:changed;
- `setOrderField(field: keyof IOrderForm, value: string)` - обновляет поле формы заказа, проверяет валидность заказа и вызывает событие order:ready, если форма валидна;
- `setContactField(field: keyof IOrderForm, value: string)` - обновляет контактное поле формы заказа, проверяет валидность контактных данных и вызывает событие contact:ready, если данные валидны;
- `validateOrder()` - проверяет валидность полей формы заказа, возвращает true, если форма валидна, иначе возвращает false и вызывает событие formErrors:change;
- `validateContact()` - проверяет валидность контактных полей формы заказа, возвращает true, если данные валидны, иначе возвращает false и вызывает событие formErrors:change;
- `resetOrderForm()` - очищает форму заказа;
- `orderData()` - собирает данные для заказа, включая id товаров из корзины и общую сумму заказа;

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементн) передаваемых данных.

### Класс `Page`
Расширяет класс Component, предназначен для управления содержимым страницы и предоставляет механизмы для отображения списка товаров и корзины.

Свойства:
- `protected _counter: HTMLElement` - элемент, представляющий счетчик товаров в корзине;
- `protected _catalog: HTMLElement` - элемент, представляющий каталог товаров;
- `protected _wrapper: HTMLElement` - элемент, представляющий обертку страницы;
- `protected _basket: HTMLElement` - элемент, представляющий кнопку корзины товаров;

Конструктор:
- `constructor(container: HTMLElement, protected events: IEvents)` - принимает корневой элемент для компонента и объект событий. В конструкторе устанавливается обработчик события для элемента корзины, который открывает окно выбранными товарами;

Методы:
- `set counter(value: number)` - устанавливает количество товаров в корзине;
- `set catalog(items: HTMLElement[])` - устанавливает список товаров;
- `set locked(value: boolean)` - устанавливает состояние блокировки страницы;

### Класс `Card`
Расширяет класс Component, предназначен для отображения и управления карточками товара.

Свойства:
- `_category` - элемент, представляющий категорию товара;
- `_title `- элемент, представляющий название товара;
- `_description` - элемент, представляющий описание товара;
- `_image` - элемент, представляющий изображение товар;
- `_button` - элемент, представляющий кнопку карточки;
- `_price` - элемент, представляющий цену товара;
- `_index` - элемент, отображающий номер товара в корзине.

Конструктор:
- `constructor(container: HTMLElement, actions?: ICardActions)` - принимает контейнер для карточки и объект действий. В конструкторе устанавливаются обработчики событий для категории, заголовка, изображения, описания, кнопки, цены.

Методы:
- `set id(value: string)` - устанавливает идентификатор товара;
- `set category(value: string)` - устанавливает категорию товара и добавляет соответствующий класс к элементу категории;
- `set title(value: string)` - устанавливает название товара;
- `set description(value: string)` - устанавливает описание карточки;
- `set image(value: string)` - устанавливает изображение карточки;
- `disableButton(isDisabled: boolean)` - устанавливает класс disabled, если цена товара null;
- `set price(value: number | null)` - устанавливает цену карточки и, если цена установлена, отключает кнопку карточки;
- `inBasket(value: boolean)` - устанавливает, находится ли карточка в корзине, и, если нет, отключает кнопку карточки.
- `index` - устанавливает порядковый номер товара в каталоге.


### Класс `Modal`

Реализует модальное окно. Предоставляет методы для управления состоянием окна и генерации событий (`modal:open`, `modal:close`).

`constructor(container: HTMLElement, protected events: IEvents)` -  принимает DOM-элемент модального окна на базе шаблона и брокер событий

Поля:
- `_closeButton` - элемент кнопки закрытия модального окна;
- `_content` - элемент с содержимым модального окна;

Методы:
- `set content` - меняет содержимое модального окна;
- `open` - открывает модальное окно и эмитит ивент `modal:open`;
- `close` - закрывает и стирает содержимое модального окна, также эмитит ивент `modal:close`;
- `render` - рендерит модальное окно с переданным содержимым и открывает его;

### Класс `Form`

Реализует общий компонент формы. Предоставляет базовые методы и сеттеры для работы с отображнем элементов формы. Эмитит событие `${field}:change` при инпуте и событие `${this.container.name}:submit` при сабмите формы.

`constructor(protected container: HTMLFormElement, protected events: IEvents)` - принимает контейнер с элементами формы, объект событий, используемый для всех полей ввода и кнопки отправки формы;

Поля:
- `_submit` - элемент кнопки для сабмита формы;
- `_errors` - контейнер с сообщениями об ошибках;

Методы:
- `protected onInputChange(field: keyof T, value: string)` - вызывается при изменении значения поля ввода и отправляет событие с измененным значением;
- `set valid(value: boolean)` - устанавливает состояние валидности формы. Если форма не валидна, кнопка отправки формы становится неактивной;
- `set errors(value: string)` - устанавливает текст ошибок ввода в элемент _errors;
- `render(state: Partial<T> & IFormState)` - рендерит форму с переданными данными и состоянием валидности;

### Класс `Basket`
Расширяет класс Component, предназначен для реализации модального окна корзины покупок.

Свойства:
- `protected _list: HTMLElement` - элемент, содержащий список товаров в корзине;
- `protected _total: HTMLElement` - элемент, отображающий общую стоимость товаров в корзине;
- `protected _button: HTMLElement` - элемент, представляющий кнопку действия (например, "Оформить заказ");

Конструктор:
- `constructor(container: HTMLElement, protected events: EventEmitter)` - принимает корневой элемент для корзины и объект событий;

Методы:
- `set items(items: HTMLElement[])` - устанавливает список товаров в корзине. Если список пуст, вместо него отображается сообщение "Корзина пуста" и кнопка не активна;
- `set total(total: number)` - устанавливает общую стоимость товаров в корзине;

### Класс `Success`
Расширяет класс Component, предназначен для реализации модального окна успешного офомления заказа.

Свойства:
- `protected _close: HTMLElement` - элемент, представляющий кнопку закрытия;

Конструктор:
- `constructor(container: HTMLElement, actions: ISuccessActions)` - принимает элемент успешной оплаты и устанавливает обработчик события для кнопки закрытия;

Методы:
- `set result(text: string)` - устанавливает сообщение об успешной оплате

### Классы для оформления заказа

### Класс `DeliveryOrderForm`
Представляет собой компонент формы, который обрабатывает форму заказа с доставкой в приложении. Он расширяет обобщенный класс Form с типом IOrder.

Свойства:
- `_card: HTMLButtonElement` - элемент кнопки для выбора метода оплаты картой.
- `_cash: HTMLButtonElement` - элемент кнопки для выбора метода оплаты наличными.
- `_address: HTMLInputElement` - элемент ввода для указания адреса доставки.
- `_contactButton: HTMLButtonElement` - элемент кнопки для отправки контактных данных.

Конструктор:
- `constructor(container: HTMLFormElement, events: IEvents)`
- `container` HTML-элемент формы, в котором содержится форма заказа;
- `events` Экземпляр объекта событий для управления событиями формы;

Методы:
- `_setPaymentMethod(payment: string)` Приватный метод для установки выбранного метода оплаты.
- `address` Свойство для установки значения адреса доставки.

### Класс `ContactOrderForm`
Класс ContactOrderForm представляет собой компонент формы, который обрабатывает контактные данные заказа в приложении. Он также расширяет обобщенный класс Form с типом IOrder.

Свойства:
- `_email: HTMLInputElement` - элемент ввода для ввода адреса электронной почты;
- `_phone: HTMLInputElement` - элемент ввода для ввода номера телефона;
- `_submitButton: HTMLButtonElement` - кнопка отправки формы;

Конструктор:
- `constructor(container: HTMLFormElement, events: IEvents)`
- `container` HTML-элемент формы, в котором содержится форма контактных данных.
- `events` Экземпляр объекта событий для управления событиями формы.

Методы:
- `email` Свойство для установки значения адреса электронной почты.
- `phone` Свойство для установки значения номера телефона.